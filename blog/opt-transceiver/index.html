<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <title>JR2HAO | 光モールストランシーバを改造してデジタル通信機を作った</title>
    
<link rel="stylesheet" href="http://jr2hao.dev/style.css?h=8c8a56e27d10588f1d5e">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.21/dist/katex.min.css" integrity="sha384-zh0CIslj+VczCZtlzBcjt5ppRcsAmDnRem7ESsYwWwg3m/OaJ2l4x7YBZl9Kxxib" crossorigin="anonymous">
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.21/dist/katex.min.js" integrity="sha384-Rma6DA2IPUwhNxmrB/7S3Tno0YY7sFu9WSYMCuulLhIqYSGZ2gKCJWIqhBWqMQfh" crossorigin="anonymous"></script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.21/dist/contrib/auto-render.min.js" integrity="sha384-hCXGrW6PitJEwbkoStFjeJxv+fSOOQKOPbJxSfM6G5sWZjAyWhXiTIIAmQqnlLlh" crossorigin="anonymous"></script>
<script>
    document.addEventListener("DOMContentLoaded", function() {
        renderMathInElement(document.body, {
          // customised options
          // • auto-render specific keys, e.g.:
          delimiters: [
              {left: '$$', right: '$$', display: true},
              {left: '$', right: '$', display: false},
              {left: '\\(', right: '\\)', display: false},
              {left: '\\[', right: '\\]', display: true}
          ],
          // • rendering keys, e.g.:
          throwOnError : false
        });
    });
</script>

    
    
    
</head>
<body>
    
<header class="space">
    <a href="javascript:history.back();">&LeftArrow; Back</a>
</header>

    
<main>
    <h1>光モールストランシーバを改造してデジタル通信機を作った</h1>
    
    <p class="secondary small">
        created at 2023&#x2F;12&#x2F;02
        , updated at 2025&#x2F;01&#x2F;24

        
        
        

        
    </p>
    
    <div class="space"></div>
    <h2 id="zi-ji-shao-jie">自己紹介</h2>
<p>はじめまして，JA1YAD所属のJR2HAOです．学部では機械工学を専攻しています．</p>
<p>アドベントカレンダーの季節がやってきましたね！と言いつつ書くのは初めてです．<br />
というかブログもまともに書いたことがないので，github.ioのマイページに直でHTMLを突っ込んでいます……（手元でMarkDownからHTMLを生成しましたよ！）<br />
それなのにとりあえず空いてるところを選べばいいやと思って2日めに突っ込んでしまったので焦って記事を作成しています……<br />
ええ，ご想像通り講義はいつも前の方に座っていますよ（ただし出席できた場合に限る）．</p>
<p>何を書こうかな～と思って，1,2週間でも余裕があればSDRやらで実験でもしてそれを記事にしてやろうとも思わないこともなかったのですが(どっち？)，さすがに時間がないので工大祭の企画展示品についてまとめます．</p>
<h2 id="toransibawogai-zao-surujing-wei">トランシーバを改造する経緯</h2>
<p>さて何を作って展示したかというのが表題の通りデジタル通信機です．<br />
その名の通りデジタルな通信をするもので，とってもデジタルです！<br />
いかがでしたか？</p>
<p>じゃあないんですよ．デジタルというのは情報の処理の仕方であって，<br />
その通信機がどういう目的でどういう情報を送りどういう媒体を使うかが全くわかりませんね．<br />
昨今はDXとかIoTとかAIとか言っておけば人が食いつくようになっていますが<br />
そんなものは手段に過ぎなくて，それを使ってどのようなことを実現するのか何が可能になったのかが大事です．<br />
にもかかわらずデジタル化された流行りの云々をさもすごいことをやっているかのように見せて人々の気を惹いている企業・省庁その他団体ならびにそれに踊らされて何もわかってないのにすごいすごいとほざく一般の連中は頭にきますが</p>
<hr />
<p>そんなことはどうでもいいんです．閑☆話☆休☆題</p>
<p>作ったものは光のON-OFFでbit列を生成してテキストを送受信するRTTY的な？ものです．</p>
<p>ことの発端はJA1YAD部員がハムフェアへ行ったときにFTR102を頂いたことです．<br />
FTR102とはキーイングに応じて光を点灯・消灯させ，受信側でその光を音に変えてモールス符号を送りあうことができるという光モールストランシーバです．<br />
わたしが驚いたのはその通信可能距離です．<br />
今までの電子工作は受光に関して知識がなかったため，とりあえずCdSセルを使っておこうとなっていました．<br />
そのため数メートルも離れてしまうと電子工作用の小さなLEDに対する感度がぐっと悪くなる傾向がありました．<br />
また可視光(もしかすると他の波長も？)すべてを受光するため部屋の電灯が雑音となることもあります．<br />
しかし使い勝手が良いので使うときはなんとなくでCdSセルを使っていました．</p>
<p>ではFTR102はどうかというと受光にフォトダイオードを使っており感度がよく，十数メートルの距離で通信することができました．<br />
また送信していないときのノイズがほぼ0だったため電圧を読んでON-OFFを判断するのが簡単だろうと思いbit列の送受信を思いつきました．</p>
<p><img src="https://scrapbox.io/files/64c619b331a115001c5b10f2.jpg" alt="" /><br />
Fig.1 FTR102, 画像は<a href="https://scrapbox.io/r16lab/FTR102%EF%BC%88%E5%85%89%E3%83%A2%E3%83%BC%E3%83%AB%E3%82%B9%E3%83%88%E3%83%A9%E3%83%B3%E3%82%B7%E3%83%BC%E3%83%90%EF%BC%89">FTR102（光モールストランシーバ）</a>より引用．</p>
<h2 id="zuo-tutamono">作ったもの</h2>
<p>今回作ったものはFTR102改造，Arduinoを使った光デジタル通信トランシーバです．<br />
FTR102についてはR16lab氏の記事<br />
<a href="https://purewhite404.github.io/works/%22https://scrapbox.io/r16lab/FTR102%EF%BC%88%E5%85%89%E3%83%A2%E3%83%BC%E3%83%AB%E3%82%B9%E3%83%88%E3%83%A9%E3%83%B3%E3%82%B7%E3%83%BC%E3%83%90%EF%BC%89%22">FTR102（光モールストランシーバ）- r16lab scrapbox</a>を，<br />
またデジタル通信プログラムについては<br />
<a href="https://projecthub.arduino.cc/saadsaif0333/data-transfer-using-led-light-li-fi-ee33a3">Data Transfer Using LED Light (Li-Fi) - Arduino Project HUB</a>を参考にしました．</p>
<p><img src="/img/lighttransceiver.jpg" alt="" />
Fig.2 作ったもの．Arduinoに簡単に取り付けられるようにカスタムシールド上に製作．</p>
<h2 id="purotokoru">プロトコル</h2>
<p>1byteの文字を読むためのタイムチャートがFig.3です．<br />
プロトコルと言っても大したものではないんですが，そのまま文字コードを送っても受信側はびっくりしてしまうのでまずは最初にStart bitを送ることにします．<br />
それから1byteを送ったあとデータが正しく受け取れているかどうかの偶数パリティCheck sum bitを送ります（あってるかどうかを1/2の確率でしか判定できないのは果たして意味があるのか，というツッコミはなしで）．</p>
<p><img src="/img/protocol.png" alt="" />
Fig.3 プロトコル概要．0x4A=Jのタイムチャート．</p>
<p>そんなわけでStart bitが1bit, データ部が8bit, Check sumが1bit<br />
の10bitで構成されています．<br />
また受信側ではチェックサムをデータ部から再計算し，<br />
送られてきたCheck sumと合っていれば1bitの応答を返すようにしました．<br />
逆にもし再計算されたCheck sumと送られたものが一致しない場合は応答は返さず，<br />
送信側は応答が返るまで送信し続けることになります．</p>
<p>送り合うデータはPCからシリアル通信で送受信することにしました．<br />
工大祭当日はTeraTermを使いました．</p>
<h2 id="dian-zi-hui-lu">電子回路</h2>
<h3 id="song-xin-bu">送信部</h3>
<p>もともとのFTR102の特徴としてマイコンを使っていないという点があります．<br />
しかしテキストデータをビット列に変換することが求められるため本家のFTR102が目指す，マイコン等デジタル回路を用いないということを諦めArduinoを使うことにしました．</p>
<p>回路図はFig.4です．マイコン側がON-OFFの制御をするので実際に光らせる部分はシンプルな構成となっています．<br />
Arduinoの信号で直接LEDを駆動させることもできますが，高輝度LEDをより強く光らせたかったためArduinoから信号を受け取りNPNトランジスタ(2SC1815)で増幅しています．<br />
データシート上ではこの回路構成で，最大約65mAの電流が流れ，これはLEDの定格70mAぎりぎりとなっています．<br />
結構まぶしいです．</p>
<p><img src="/img/schematic.png" alt="" />
Fig.4 送信部回路図</p>
<h3 id="shou-xin-bu">受信部</h3>
<p>FTR102とほぼ同じです！なのでそっちを見てください！（投げやり）<br />
いろいろコンデンサの容量を変えたりして受信波形を調整しましたが結局本家がよくできているんだなあという結論に至りました．<br />
変えた点といえば終段のオペアンプ増幅部を2段にしたことです．フォトICダイオードで受け取った光信号を増幅するだけではきれいな0,1の信号にならず，曖昧な電圧になってしまうためです（ただ実装に問題がありそうなので改良が必要……）．</p>
<h2 id="shi-yan-jie-guo">実験結果</h2>
<p>5m離れたところからの送受信をしました．</p>
<p><img src="/img/result1.jpg" alt="" /> <img src="/img/result2.jpg" alt="" />
Fig.5 送信機側（左）と受信機側（右）シリアルコンソール画面</p>
<p>写真撮影時はいい感じでは！？と思っていたのですが， もう少し動かすとうまく受け取れる文字とそうでない文字がありました． とくにビット列として1が連続する箇所が多い文字は 電圧が途中で減衰して0になってしまっているような気がしています．</p>
<p>それから伝送路，あるいは受信側の問題で応答が返らなかったときに続けて送信するといざ実際に伝送路・受信側が正常に機能し始めると，データ列やチェックサムをStart bitとして認識してしまいます．そのため誤ったデータを受信してしまうという事になってしまいました．<br />
こうなるともう確率1/2ということも含めてチェックサムはほぼ機能してないと言えるでしょう．</p>
<p>まあでも誤り訂正してます！受信側から応答が返ります！ってかっこいいですよね？？<br />
シリアルコンソール画面に受信された文字が一文字ずつピロピロピロ～と表示されるのも，いかにもハッカーになった気分でとても楽しいです．<br />
考えてみればやってることはリモコンと同じではあるのですが，赤色LEDを使ってチカチカさせるととても面白いです．</p>
<h2 id="gai-liang-dian">改良点</h2>
<ul>
<li>文章全体でチェックサムをかける</li>
<li>スタートビットとデータ列の区別ができるようなプロトコルへ変更</li>
<li>応答速度の早いフォトダイオードを用いて受信することによるデータレートの向上</li>
</ul>
<h2 id="matome">まとめ</h2>
<p>とってもデジタルでしたね！（？）<br />
もうデジタルはお腹いっぱいなので次回の工大祭はアナログPID制御でなんか作る！かも……デュエルスタンバイ！</p>
<p>Advent calendar, 明日はtokinasinさんの<a href="https://sizu.me/tokinasin/posts/edoi47h99anm">JCCコードを地名に変換するSKK辞書を作ってみました</a>をお楽しみに！（<a href="https://adventar.org/calendars/9345">大学無線部Advent Calendar</a>の記事はこちらから確認できます）</p>

</main>

    <div class="dark-mode-buttons">
        <button class="dark-mode-button" id="dark-mode-on"><img src="http://jr2hao.dev/dark_mode.svg" width="24" height="24" alt="Dark mode" aria-label="dark mode toggle" title="Dark mode"></button>
        <button class="dark-mode-button" id="dark-mode-off"><img src="http://jr2hao.dev/light_mode.svg" width="24" height="24" alt="Light mode" aria-label="light mode toggle" title="Light mode"></button>
    </div>
    <script>
        const cls = document.querySelector("html").classList;
        const sessionTheme = sessionStorage.getItem("theme");

        function setDark() {
            cls.add("dark-mode");
            cls.remove("light-mode");
            sessionStorage.setItem("theme", "dark");
        }
        function setLight() {
            cls.add("light-mode");
            cls.remove("dark-mode");
            sessionStorage.setItem("theme", "light");
        }

        if (sessionTheme === "dark") {
            setDark();
        } else if (sessionTheme === "light") {
            setLight();
        } else if (window.matchMedia("(prefers-color-scheme: dark)").matches) {
            setDark();
        }

        document.getElementById("dark-mode-on").addEventListener("click", function(e) {
            setDark();
        });
        document.getElementById("dark-mode-off").addEventListener("click", function(e) {
            setLight();
        });
    </script>
    <noscript>
        <style>
            .dark-mode-buttons {
                display: none;
            }
        </style>
    </noscript>
    <footer>
            <small>
                2025 jr2hao all rights reserved
            </small>
    </footer>
</body>
</html>
